<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SessionFS - A session based VFS wrapper: src/kmodule/session_manager.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="data-storage.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SessionFS - A session based VFS wrapper
   </div>
   <div id="projectbrief">Advanced Operating Systems and Virtualization - A.A. 2018/2019 Final Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('session__manager_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">session_manager.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>APIs used to interact with the session manger, component of the <em>Session Manager</em> submodule.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;linux/types.h&gt;</code><br />
<code>#include &quot;<a class="el" href="session__types_8h.html">session_types.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for session_manager.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h__incl.png" border="0" usemap="#src_2kmodule_2session__manager_8h" alt=""/></div>
<map name="src_2kmodule_2session__manager_8h" id="src_2kmodule_2session__manager_8h">
<area shape="rect" title="APIs used to interact with the session manger, component of the Session Manager submodule." alt="" coords="52,5,207,47"/>
<area shape="rect" title=" " alt="" coords="5,95,112,121"/>
<area shape="rect" href="session__types_8h.html" title=" " alt="" coords="137,95,263,121"/>
<area shape="rect" title=" " alt="" coords="141,169,259,196"/>
</map>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h__dep__incl.png" border="0" usemap="#src_2kmodule_2session__manager_8hdep" alt=""/></div>
<map name="src_2kmodule_2session__manager_8hdep" id="src_2kmodule_2session__manager_8hdep">
<area shape="rect" title="APIs used to interact with the session manger, component of the Session Manager submodule." alt="" coords="91,5,245,47"/>
<area shape="rect" href="device__sessionfs_8c.html" title="Implementation of the virtual character device that will handle sessions, component of the Character ..." alt="" coords="5,95,155,136"/>
<area shape="rect" href="session__manager_8c.html" title="Implementation of the Session Manager submodule." alt="" coords="179,95,333,136"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a96edb8992f8537a88c79b896b45d47c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2">clean_manager</a> (void)</td></tr>
<tr class="memdesc:a96edb8992f8537a88c79b896b45d47c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases all the incarnations that are associated with a dead/zombie pid.  <a href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2">More...</a><br /></td></tr>
<tr class="separator:a96edb8992f8537a88c79b896b45d47c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1594b401bd3a9bb39decd88759bfbebd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">close_session</a> (const char *pathname, int fdes, pid_t pid)</td></tr>
<tr class="memdesc:a1594b401bd3a9bb39decd88759bfbebd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes a session.  <a href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">More...</a><br /></td></tr>
<tr class="separator:a1594b401bd3a9bb39decd88759bfbebd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae86586f2293bf35b1b57be58af0b9588"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structincarnation.html">incarnation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">create_session</a> (const char *pathname, int flags, pid_t pid, mode_t mode)</td></tr>
<tr class="memdesc:ae86586f2293bf35b1b57be58af0b9588"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new session for the specified file.  <a href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">More...</a><br /></td></tr>
<tr class="separator:ae86586f2293bf35b1b57be58af0b9588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd67495092f6edf4b7e5b6ae94be3154"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8h.html#abd67495092f6edf4b7e5b6ae94be3154">init_manager</a> (void)</td></tr>
<tr class="memdesc:abd67495092f6edf4b7e5b6ae94be3154"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization of the session manager data structures.  <a href="session__manager_8h.html#abd67495092f6edf4b7e5b6ae94be3154">More...</a><br /></td></tr>
<tr class="separator:abd67495092f6edf4b7e5b6ae94be3154"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>APIs used to interact with the session manger, component of the <em>Session Manager</em> submodule. </p>
<p>This file contains the APIs of the session manager, which are used to initialize and release the manager and to add and remove sessions. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a96edb8992f8537a88c79b896b45d47c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96edb8992f8537a88c79b896b45d47c2">&#9670;&nbsp;</a></span>clean_manager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int clean_manager </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases all the incarnations that are associated with a dead/zombie pid. </p>
<dl class="section return"><dt>Returns</dt><dd>the number of sessions associated with an active pid.</dd></dl>
<p>This method will walk through the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list and each <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> list, deleting all the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s) and <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s) in which the process that has requested it is not active anymore, leaving the original files untouched. If there is an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> that is still in use by an active process it will be preserved.</p>
<p>To check if an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> is still active we get the struct pid from the pid number included in the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>; if we receive it, the process is at most in a zombie state.</p>
<p>When walking the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list we increment the refcount of the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> in use to avoid having it removed while we are using it. We remove all the elements in the <code>incarnations</code> lockless list and we add back the objects, closing the others without modifing the original file and updating SysFS with <code><a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject.">remove_incarnation_info()</a></code>, without deallcoating the dead <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s). If a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> has no active incarnations it will be flagged as invalid and removed during a second walk, where, with <code><a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation.">delete_incarnation()</a></code>, we remove all the invalid <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s) and deallocate al the associated <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s).</p>
<p><b>NOTE:</b> For dead incarnations that have not been closed we leave the files in the folder, since can't remove them from kernel space. Userspace will need to manually remove incarnations file for invalid processes. </p>
<p>We consider as invalid a session which is associated to a dead process.</p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu()</a>, <a class="el" href="session__manager_8c.html#a91921ad939cc0735cd98abf327aa9eae">MANAGER_EMPTY</a>, <a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0">remove_incarnation_info()</a>, <a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1">remove_session_info()</a>, <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>, and <a class="el" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843">release_device()</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_cgraph.png" border="0" usemap="#session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_cgraph" alt=""/></div>
<map name="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_cgraph" id="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_cgraph">
<area shape="rect" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="5,81,128,108"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="209,5,327,32"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="195,56,341,83"/>
<area shape="rect" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject." alt="" coords="176,107,360,133"/>
<area shape="rect" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject." alt="" coords="188,157,348,184"/>
</map>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_icgraph.png" border="0" usemap="#session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_icgraph" alt=""/></div>
<map name="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_icgraph" id="session__manager_8h_a96edb8992f8537a88c79b896b45d47c2_icgraph">
<area shape="rect" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="531,31,653,57"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="373,5,473,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843" title="Releases the device and frees the used memory." alt="" coords="363,56,483,83"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="199,5,292,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
<area shape="rect" href="module_8c.html#abd810a6f947c3b87a782a9aad746eef3" title=" " alt="" coords="176,56,315,83"/>
</map>
</div>

</div>
</div>
<a id="a1594b401bd3a9bb39decd88759bfbebd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1594b401bd3a9bb39decd88759bfbebd">&#9670;&nbsp;</a></span>close_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fdes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes a session. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pathname</td><td>the pathname for the session containing the incarnation that is being closed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fdes</td><td>The file descriptor of a session incarnation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pid</td><td>The owner process pid. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success or an error code.</dd></dl>
<p>This function will close one session, by finding the corresponding <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>, using <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>, copying the incarnation file over the original file (atomically in respect to other session operations on the same original file, and only if the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> is valid), and deleting the incarnation, using <code><a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation.">delete_incarnation()</a></code>. If after the incarnation deletion the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> has no other <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s) the it will also schedule the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> to be removed. </p>
<p>If we cannot locate the parent session of an incarnation <code>-EBADF</code> is returned.</p>
<p>To remove a session object we need to check several conditions:</p><ul>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be not in use by other threads (refcount==1)</li>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> kernel object refcount, in the <code>info</code> member, must be 1</li>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be still valid and not already marked for deletion</li>
</ul>
<p>If the current <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be removed, we flag it as invalid, to avoid having new incarnations created in here before deallocating it and making sure that it will be eventually deallocated.</p>
<p>We also remove its information on SysFS using <code><a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject.">remove_session_info()</a></code>.</p>
<p>Then, we can remove the current <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object from the rcu list, using the <code><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc" title="Spinlock used to update the list of the active session(s)">sessions_lock</a></code> spinlock to avoid concurrent operations.</p>
<p>Finally, we try to deallocate the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> if is invalid, using <code><a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object.">delete_session()</a></code>.</p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d">delete_incarnation()</a>, <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu()</a>, <a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb">OVERWRITE_ORIG</a>, <a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1">remove_session_info()</a>, <a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session()</a>, <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_cgraph.png" border="0" usemap="#session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_cgraph" alt=""/></div>
<map name="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_cgraph" id="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_cgraph">
<area shape="rect" title="Closes a session." alt="" coords="5,132,117,159"/>
<area shape="rect" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation." alt="" coords="174,31,317,57"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="186,81,305,108"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="172,132,319,159"/>
<area shape="rect" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject." alt="" coords="165,183,325,209"/>
<area shape="rect" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="185,233,306,260"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="425,5,506,32"/>
<area shape="rect" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject." alt="" coords="373,56,557,83"/>
</map>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_icgraph.png" border="0" usemap="#session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_icgraph" alt=""/></div>
<map name="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_icgraph" id="session__manager_8h_a1594b401bd3a9bb39decd88759bfbebd_icgraph">
<area shape="rect" title="Closes a session." alt="" coords="465,5,577,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="ae86586f2293bf35b1b57be58af0b9588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae86586f2293bf35b1b57be58af0b9588">&#9670;&nbsp;</a></span>create_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structincarnation.html">incarnation</a>* create_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new session for the specified file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pathname</td><td>The pathname of the file in which the session will be created. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>The flags that specify the permissions on the file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pid</td><td>The pid of the process that wants to create the session. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>The permissions to apply to newly created files. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to an <a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a> object, containing all the info on the current incarnation or an error code.</dd></dl>
<p>To create a new session we check if the original file was already opened with session semantic, by searching for an existing <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> with the same <code>pathname</code> using <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>. If the found <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> is invalid or a matching <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object is not found a new <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object will be created, using <code><a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname.">init_session()</a></code>. Then we create a new <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> of the original file with <code><a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session.">create_incarnation()</a></code>.</p>
<p>When the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> has been created the <code>refcount</code> of the parent session is decremented.</p>
<p><code>-EAGAIN</code> is returned if the created session is invalid. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">create_incarnation()</a>, <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>, <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>, <a class="el" href="session__manager_8c.html#ad40327c746e8ef715109d9b9257eb991">NO_PID</a>, <a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session()</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_cgraph.png" border="0" usemap="#session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_cgraph" alt=""/></div>
<map name="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_cgraph" id="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_cgraph">
<area shape="rect" title="Create a new session for the specified file." alt="" coords="5,183,124,209"/>
<area shape="rect" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session." alt="" coords="172,81,315,108"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="383,157,501,184"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="194,208,293,235"/>
<area shape="rect" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="381,309,503,336"/>
<area shape="rect" href="session__info_8c.html#a05e60807f715e0eee172cc7f4f58aec7" title="Adds a new kobject attribute representing an incarnation." alt="" coords="363,56,521,83"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="401,5,483,32"/>
<area shape="rect" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space." alt="" coords="401,107,483,133"/>
<area shape="rect" href="session__info_8c.html#af9d987f87f3c55859d5f3712989a8ac7" title="The function used to read the SysFS incarnations attribute files." alt="" coords="577,56,711,83"/>
<area shape="rect" href="session__info_8c.html#a5c06075650f0014909ac3ed682ff71aa" title="Adds a new kobject representing an original file, under the SessionFS kobject." alt="" coords="375,259,509,285"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="369,208,515,235"/>
<area shape="rect" href="session__info_8c.html#a6e1507e9b7ff0a2d7eae6e9db7a6a41a" title="The function used to read the SysFS active_incarnations_num attribute file." alt="" coords="569,251,719,293"/>
</map>
</div>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_icgraph.png" border="0" usemap="#session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_icgraph" alt=""/></div>
<map name="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_icgraph" id="session__manager_8h_ae86586f2293bf35b1b57be58af0b9588_icgraph">
<area shape="rect" title="Create a new session for the specified file." alt="" coords="465,5,584,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="abd67495092f6edf4b7e5b6ae94be3154"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd67495092f6edf4b7e5b6ae94be3154">&#9670;&nbsp;</a></span>init_manager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_manager </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization of the session manager data structures. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on success or an error code.</dd></dl>
<p>Initializes the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> global variable as an empty list. Avoids the RCU initialization since we can't receive requests yet, so no one will use this list for now. Then initializes the <code><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc" title="Spinlock used to update the list of the active session(s)">sessions_lock</a></code> spinlock. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, and <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab">init_device()</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8h_abd67495092f6edf4b7e5b6ae94be3154_icgraph.png" border="0" usemap="#session__manager_8h_abd67495092f6edf4b7e5b6ae94be3154_icgraph" alt=""/></div>
<map name="session__manager_8h_abd67495092f6edf4b7e5b6ae94be3154_icgraph" id="session__manager_8h_abd67495092f6edf4b7e5b6ae94be3154_icgraph">
<area shape="rect" title="Initialization of the session manager data structures." alt="" coords="317,5,425,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_b6e26c987379c818ae1a7be6334a2c88.html">kmodule</a></li><li class="navelem"><a class="el" href="session__manager_8h.html">session_manager.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
