<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SessionFS - A session based VFS wrapper: src/kmodule/session_manager.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="data-storage.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SessionFS - A session based VFS wrapper
   </div>
   <div id="projectbrief">Advanced Operating Systems and Virtualization - A.A. 2018/2019 Final Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('session__manager_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">session_manager.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of the <em>Session Manager</em> submodule.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;linux/types.h&gt;</code><br />
<code>#include &lt;uapi/linux/limits.h&gt;</code><br />
<code>#include &lt;linux/spinlock.h&gt;</code><br />
<code>#include &lt;linux/llist.h&gt;</code><br />
<code>#include &lt;linux/list.h&gt;</code><br />
<code>#include &lt;linux/rculist.h&gt;</code><br />
<code>#include &lt;linux/fs.h&gt;</code><br />
<code>#include &lt;linux/file.h&gt;</code><br />
<code>#include &lt;linux/slab.h&gt;</code><br />
<code>#include &lt;linux/err.h&gt;</code><br />
<code>#include &lt;uapi/asm-generic/errno.h&gt;</code><br />
<code>#include &lt;linux/timekeeping.h&gt;</code><br />
<code>#include &lt;uapi/asm-generic/fcntl.h&gt;</code><br />
<code>#include &lt;linux/fsnotify.h&gt;</code><br />
<code>#include &lt;linux/pid.h&gt;</code><br />
<code>#include &quot;<a class="el" href="session__manager_8h.html">session_manager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="session__info_8h.html">session_info.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for session_manager.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c__incl.png" border="0" usemap="#src_2kmodule_2session__manager_8c" alt=""/></div>
<map name="src_2kmodule_2session__manager_8c" id="src_2kmodule_2session__manager_8c">
<area shape="rect" title="Implementation of the Session Manager submodule." alt="" coords="985,5,1140,47"/>
<area shape="rect" title=" " alt="" coords="5,169,112,196"/>
<area shape="rect" title=" " alt="" coords="340,95,479,121"/>
<area shape="rect" title=" " alt="" coords="503,95,627,121"/>
<area shape="rect" title=" " alt="" coords="651,95,746,121"/>
<area shape="rect" title=" " alt="" coords="771,95,861,121"/>
<area shape="rect" title=" " alt="" coords="886,95,997,121"/>
<area shape="rect" title=" " alt="" coords="1021,95,1104,121"/>
<area shape="rect" title=" " alt="" coords="1128,95,1219,121"/>
<area shape="rect" title=" " alt="" coords="1243,95,1341,121"/>
<area shape="rect" title=" " alt="" coords="1365,95,1453,121"/>
<area shape="rect" title=" " alt="" coords="1478,95,1663,121"/>
<area shape="rect" title=" " alt="" coords="1687,95,1838,121"/>
<area shape="rect" title=" " alt="" coords="1862,95,2042,121"/>
<area shape="rect" title=" " alt="" coords="2066,95,2185,121"/>
<area shape="rect" title=" " alt="" coords="2209,95,2300,121"/>
<area shape="rect" href="session__manager_8h.html" title="APIs used to interact with the session manger, component of the Session Manager submodule." alt="" coords="29,95,177,121"/>
<area shape="rect" href="session__info_8h.html" title="Handles the kobjects for the session manager, part of the Session Information submodule...." alt="" coords="201,95,316,121"/>
<area shape="rect" href="session__types_8h.html" title=" " alt="" coords="137,169,263,196"/>
<area shape="rect" title=" " alt="" coords="192,244,309,271"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a68c0ab1dd55579ffd14f86b660773248"><td class="memItemLeft" align="right" valign="top"><a id="a68c0ab1dd55579ffd14f86b660773248"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a68c0ab1dd55579ffd14f86b660773248">DATA_DIM</a>&#160;&#160;&#160;512</td></tr>
<tr class="memdesc:a68c0ab1dd55579ffd14f86b660773248"><td class="mdescLeft">&#160;</td><td class="mdescRight">The portion of the file which is copied at each read/write iteration. <br /></td></tr>
<tr class="separator:a68c0ab1dd55579ffd14f86b660773248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae93be9f917eb7dbc1863a710f7a7b0bc"><td class="memItemLeft" align="right" valign="top"><a id="ae93be9f917eb7dbc1863a710f7a7b0bc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#ae93be9f917eb7dbc1863a710f7a7b0bc">DEFAULT_PERM</a>&#160;&#160;&#160;0644</td></tr>
<tr class="memdesc:ae93be9f917eb7dbc1863a710f7a7b0bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permissions to be given to the newly created files. <br /></td></tr>
<tr class="separator:ae93be9f917eb7dbc1863a710f7a7b0bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91921ad939cc0735cd98abf327aa9eae"><td class="memItemLeft" align="right" valign="top"><a id="a91921ad939cc0735cd98abf327aa9eae"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a91921ad939cc0735cd98abf327aa9eae">MANAGER_EMPTY</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:a91921ad939cc0735cd98abf327aa9eae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine is the session manager contains active sessions. <br /></td></tr>
<tr class="separator:a91921ad939cc0735cd98abf327aa9eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa071d9c19b2a41c3c4efe8d803d74a24"><td class="memItemLeft" align="right" valign="top"><a id="aa071d9c19b2a41c3c4efe8d803d74a24"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:aa071d9c19b2a41c3c4efe8d803d74a24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to toggle the necessity of a file descriptor in <code><a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space.">open_file()</a></code> and to determine the type of search in <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>. <br /></td></tr>
<tr class="separator:aa071d9c19b2a41c3c4efe8d803d74a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad40327c746e8ef715109d9b9257eb991"><td class="memItemLeft" align="right" valign="top"><a id="ad40327c746e8ef715109d9b9257eb991"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#ad40327c746e8ef715109d9b9257eb991">NO_PID</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:ad40327c746e8ef715109d9b9257eb991"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine the type of search in <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>. <br /></td></tr>
<tr class="separator:ad40327c746e8ef715109d9b9257eb991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84e60a710f82dcfbc7f311e7787afedb"><td class="memItemLeft" align="right" valign="top"><a id="a84e60a710f82dcfbc7f311e7787afedb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb">OVERWRITE_ORIG</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:a84e60a710f82dcfbc7f311e7787afedb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine if the content of the incarnation must overwrite the original file on close. <br /></td></tr>
<tr class="separator:a84e60a710f82dcfbc7f311e7787afedb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a555d7056ccbb35a92c11165f1e82c406"><td class="memItemLeft" align="right" valign="top"><a id="a555d7056ccbb35a92c11165f1e82c406"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:a555d7056ccbb35a92c11165f1e82c406"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine if a session node is valid. <br /></td></tr>
<tr class="separator:a555d7056ccbb35a92c11165f1e82c406"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a96edb8992f8537a88c79b896b45d47c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a96edb8992f8537a88c79b896b45d47c2">clean_manager</a> (void)</td></tr>
<tr class="memdesc:a96edb8992f8537a88c79b896b45d47c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases all the incarnations that are associated with a dead/zombie pid.  <a href="session__manager_8c.html#a96edb8992f8537a88c79b896b45d47c2">More...</a><br /></td></tr>
<tr class="separator:a96edb8992f8537a88c79b896b45d47c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1594b401bd3a9bb39decd88759bfbebd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a1594b401bd3a9bb39decd88759bfbebd">close_session</a> (const char *pathname, int fdes, pid_t pid)</td></tr>
<tr class="memdesc:a1594b401bd3a9bb39decd88759bfbebd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes a session.  <a href="session__manager_8c.html#a1594b401bd3a9bb39decd88759bfbebd">More...</a><br /></td></tr>
<tr class="separator:a1594b401bd3a9bb39decd88759bfbebd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c0e032011c18f8eb45eaa72a9a656d6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6">copy_file</a> (struct file *src, struct file *dst)</td></tr>
<tr class="memdesc:a8c0e032011c18f8eb45eaa72a9a656d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the contents of a file into another.  <a href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6">More...</a><br /></td></tr>
<tr class="separator:a8c0e032011c18f8eb45eaa72a9a656d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c676ca524171b7f600b7f0189266167"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structincarnation.html">incarnation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">create_incarnation</a> (struct <a class="el" href="structsession.html">session</a> *<a class="el" href="structsession.html">session</a>, int flags, pid_t pid, mode_t mode)</td></tr>
<tr class="memdesc:a2c676ca524171b7f600b7f0189266167"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> and add it to an existing <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>.  <a href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">More...</a><br /></td></tr>
<tr class="separator:a2c676ca524171b7f600b7f0189266167"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae86586f2293bf35b1b57be58af0b9588"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structincarnation.html">incarnation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#ae86586f2293bf35b1b57be58af0b9588">create_session</a> (const char *pathname, int flags, pid_t pid, mode_t mode)</td></tr>
<tr class="memdesc:ae86586f2293bf35b1b57be58af0b9588"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new session for the specified file.  <a href="session__manager_8c.html#ae86586f2293bf35b1b57be58af0b9588">More...</a><br /></td></tr>
<tr class="separator:ae86586f2293bf35b1b57be58af0b9588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18273cf2fcf61730e36b611412c0700d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d">delete_incarnation</a> (struct <a class="el" href="structsession.html">session</a> *<a class="el" href="structsession.html">session</a>, int filedes, pid_t pid, int overwrite)</td></tr>
<tr class="memdesc:a18273cf2fcf61730e36b611412c0700d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the given <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>.  <a href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d">More...</a><br /></td></tr>
<tr class="separator:a18273cf2fcf61730e36b611412c0700d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a018bae728d08b5091b906f491019b6c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session</a> (struct <a class="el" href="structsession.html">session</a> *<a class="el" href="structsession.html">session</a>)</td></tr>
<tr class="memdesc:a018bae728d08b5091b906f491019b6c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocates the given session object.  <a href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">More...</a><br /></td></tr>
<tr class="separator:a018bae728d08b5091b906f491019b6c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34e2a89cc6c7c38749c5da0ef5c18fd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu</a> (struct rcu_head *head)</td></tr>
<tr class="memdesc:a34e2a89cc6c7c38749c5da0ef5c18fd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocates a <code><a class="el" href="structsession__rcu.html" title="RCU item that contains a session.">session_rcu</a></code> element.  <a href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">More...</a><br /></td></tr>
<tr class="separator:a34e2a89cc6c7c38749c5da0ef5c18fd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd67495092f6edf4b7e5b6ae94be3154"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#abd67495092f6edf4b7e5b6ae94be3154">init_manager</a> (void)</td></tr>
<tr class="memdesc:abd67495092f6edf4b7e5b6ae94be3154"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization of the session manager data structures.  <a href="session__manager_8c.html#abd67495092f6edf4b7e5b6ae94be3154">More...</a><br /></td></tr>
<tr class="separator:abd67495092f6edf4b7e5b6ae94be3154"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe3ac55880f2af28017214c50a38d487"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsession.html">session</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session</a> (const char *pathname, int flags, mode_t mode)</td></tr>
<tr class="memdesc:abe3ac55880f2af28017214c50a38d487"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the session information for the given pathname.  <a href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">More...</a><br /></td></tr>
<tr class="separator:abe3ac55880f2af28017214c50a38d487"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd653e4fa6e0dd5f0b4ea3d697679d8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8">open_file</a> (const char *pathname, int flags, mode_t mode, int fd_needed, struct file **file)</td></tr>
<tr class="memdesc:a2dd653e4fa6e0dd5f0b4ea3d697679d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens a file from kernel space.  <a href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8">More...</a><br /></td></tr>
<tr class="separator:a2dd653e4fa6e0dd5f0b4ea3d697679d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe5de8d0745f9cc09c02191e1818001f"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsession.html">session</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session</a> (const char *pathname, int filedes, pid_t pid)</td></tr>
<tr class="memdesc:abe5de8d0745f9cc09c02191e1818001f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Searches for a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> with a given pathname, or with an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> with matching pid and file descriptor.  <a href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">More...</a><br /></td></tr>
<tr class="separator:abe5de8d0745f9cc09c02191e1818001f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a16d321e233eeb27c5fa65d1b7519477e"><td class="memItemLeft" align="right" valign="top"><a id="a16d321e233eeb27c5fa65d1b7519477e"></a>
struct list_head&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a></td></tr>
<tr class="memdesc:a16d321e233eeb27c5fa65d1b7519477e"><td class="mdescLeft">&#160;</td><td class="mdescRight">List of the active <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s). <br /></td></tr>
<tr class="separator:a16d321e233eeb27c5fa65d1b7519477e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8969353f4c2bc47763ade4fc6cf466dc"><td class="memItemLeft" align="right" valign="top"><a id="a8969353f4c2bc47763ade4fc6cf466dc"></a>
spinlock_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a></td></tr>
<tr class="memdesc:a8969353f4c2bc47763ade4fc6cf466dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Spinlock used to update the list of the active <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s) <br /></td></tr>
<tr class="separator:a8969353f4c2bc47763ade4fc6cf466dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of the <em>Session Manager</em> submodule. </p>
<p>This file contains the implementation of the session manager, which will handle the creation and deletion of a session, keeping track of the opened sessions for each file. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a96edb8992f8537a88c79b896b45d47c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96edb8992f8537a88c79b896b45d47c2">&#9670;&nbsp;</a></span>clean_manager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int clean_manager </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases all the incarnations that are associated with a dead/zombie pid. </p>
<p>This method will walk through the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list and each <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> list, deleting all the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s) and <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s) in which the process that has requested it is not active anymore, leaving the original files untouched. If there is an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> that is still in use by an active process it will be preserved.</p>
<p>To check if an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> is still active we get the struct pid from the pid number included in the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>; if we receive it, the process is at most in a zombie state.</p>
<p>When walking the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list we increment the refcount of the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> in use to avoid having it removed while we are using it. We remove all the elements in the <code>incarnations</code> lockless list and we add back the objects, closing the others without modifing the original file and updating SysFS with <code><a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject.">remove_incarnation_info()</a></code>, without deallcoating the dead <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s). If a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> has no active incarnations it will be flagged as invalid and removed during a second walk, where, with <code><a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation.">delete_incarnation()</a></code>, we remove all the invalid <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>(s) and deallocate al the associated <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s).</p>
<p><b>NOTE:</b> For dead incarnations that have not been closed we leave the files in the folder, since can't remove them from kernel space. Userspace will need to manually remove incarnations file for invalid processes. </p>
<p>We consider as invalid a session which is associated to a dead process.</p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu()</a>, <a class="el" href="session__manager_8c.html#a91921ad939cc0735cd98abf327aa9eae">MANAGER_EMPTY</a>, <a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0">remove_incarnation_info()</a>, <a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1">remove_session_info()</a>, <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>, and <a class="el" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843">release_device()</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_cgraph.png" border="0" usemap="#session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_cgraph" alt=""/></div>
<map name="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_cgraph" id="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_cgraph">
<area shape="rect" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="5,81,128,108"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="209,5,327,32"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="195,56,341,83"/>
<area shape="rect" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject." alt="" coords="176,107,360,133"/>
<area shape="rect" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject." alt="" coords="188,157,348,184"/>
</map>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_icgraph.png" border="0" usemap="#session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_icgraph" alt=""/></div>
<map name="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_icgraph" id="session__manager_8c_a96edb8992f8537a88c79b896b45d47c2_icgraph">
<area shape="rect" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="531,31,653,57"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="373,5,473,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843" title="Releases the device and frees the used memory." alt="" coords="363,56,483,83"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="199,5,292,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
<area shape="rect" href="module_8c.html#abd810a6f947c3b87a782a9aad746eef3" title=" " alt="" coords="176,56,315,83"/>
</map>
</div>

</div>
</div>
<a id="a1594b401bd3a9bb39decd88759bfbebd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1594b401bd3a9bb39decd88759bfbebd">&#9670;&nbsp;</a></span>close_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fdes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes a session. </p>
<p>This function will close one session, by finding the corresponding <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>, using <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>, copying the incarnation file over the original file (atomically in respect to other session operations on the same original file, and only if the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> is valid), and deleting the incarnation, using <code><a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation.">delete_incarnation()</a></code>. If after the incarnation deletion the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> has no other <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>(s) the it will also schedule the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> to be removed. </p>
<p>If we cannot locate the parent session of an incarnation <code>-EBADF</code> is returned.</p>
<p>To remove a session object we need to check several conditions:</p><ul>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be not in use by other threads (refcount==1)</li>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> kernel object refcount, in the <code>info</code> member, must be 1</li>
<li>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be still valid and not already marked for deletion</li>
</ul>
<p>If the current <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> must be removed, we flag it as invalid, to avoid having new incarnations created in here before deallocating it and making sure that it will be eventually deallocated.</p>
<p>We also remove its information on SysFS using <code><a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject.">remove_session_info()</a></code>.</p>
<p>Then, we can remove the current <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object from the rcu list, using the <code><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc" title="Spinlock used to update the list of the active session(s)">sessions_lock</a></code> spinlock to avoid concurrent operations.</p>
<p>Finally, we try to deallocate the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> if is invalid, using <code><a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object.">delete_session()</a></code>.</p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d">delete_incarnation()</a>, <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu()</a>, <a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb">OVERWRITE_ORIG</a>, <a class="el" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1">remove_session_info()</a>, <a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session()</a>, <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_cgraph.png" border="0" usemap="#session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_cgraph" alt=""/></div>
<map name="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_cgraph" id="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_cgraph">
<area shape="rect" title="Closes a session." alt="" coords="5,132,117,159"/>
<area shape="rect" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation." alt="" coords="174,31,317,57"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="186,81,305,108"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="172,132,319,159"/>
<area shape="rect" href="session__info_8c.html#af00564d2a553b340f5c6a028eec867c1" title="Removes a session kobject." alt="" coords="165,183,325,209"/>
<area shape="rect" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="185,233,306,260"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="425,5,506,32"/>
<area shape="rect" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject." alt="" coords="373,56,557,83"/>
</map>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_icgraph.png" border="0" usemap="#session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_icgraph" alt=""/></div>
<map name="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_icgraph" id="session__manager_8c_a1594b401bd3a9bb39decd88759bfbebd_icgraph">
<area shape="rect" title="Closes a session." alt="" coords="465,5,577,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="a8c0e032011c18f8eb45eaa72a9a656d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c0e032011c18f8eb45eaa72a9a656d6">&#9670;&nbsp;</a></span>copy_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int copy_file </td>
          <td>(</td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>dst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy the contents of a file into another. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>The source file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>The destination file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, an error code on failure.</dd></dl>
<p>Reads <code><a class="el" href="session__manager_8c.html#a68c0ab1dd55579ffd14f86b660773248" title="The portion of the file which is copied at each read/write iteration.">DATA_DIM</a></code> bytes from <code>src</code> and writes them on <code>dst</code>, starting in both files from the beginning and stopping when <code>src</code> is has been completely read. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a68c0ab1dd55579ffd14f86b660773248">DATA_DIM</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">create_incarnation()</a>, and <a class="el" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d">delete_incarnation()</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a8c0e032011c18f8eb45eaa72a9a656d6_icgraph.png" border="0" usemap="#session__manager_8c_a8c0e032011c18f8eb45eaa72a9a656d6_icgraph" alt=""/></div>
<map name="session__manager_8c_a8c0e032011c18f8eb45eaa72a9a656d6_icgraph" id="session__manager_8c_a8c0e032011c18f8eb45eaa72a9a656d6_icgraph">
<area shape="rect" title="Copy the contents of a file into another." alt="" coords="823,31,904,57"/>
<area shape="rect" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session." alt="" coords="632,5,775,32"/>
<area shape="rect" href="session__manager_8c.html#a18273cf2fcf61730e36b611412c0700d" title="Removes the given incarnation." alt="" coords="632,56,775,83"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="465,5,584,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,31,417,57"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,31,269,57"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,31,128,57"/>
<area shape="rect" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd" title="Closes a session." alt="" coords="469,56,581,83"/>
</map>
</div>

</div>
</div>
<a id="a2c676ca524171b7f600b7f0189266167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c676ca524171b7f600b7f0189266167">&#9670;&nbsp;</a></span>create_incarnation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structincarnation.html">incarnation</a>* create_incarnation </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsession.html">session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> and add it to an existing <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>The <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object that represents the file in which we want to create a new <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>The flags the regulates how the file must be opened. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pid</td><td>The pid of the process that wants the create a new <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>The permissions to apply to newly created files. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The file descriptor of the new <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> or an error code (<code>-EAGAIN</code> if the parent session is invalid).</dd></dl>
<p>Creates an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> by updating the information on SysFS using <code><a class="el" href="session__info_8c.html#a05e60807f715e0eee172cc7f4f58aec7" title="Adds a new kobject attribute representing an incarnation.">add_incarnation_info()</a></code> and opening a new file, using <code><a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space.">open_file()</a></code>, copying the contents of the original file in the new file, using <code><a class="el" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another.">copy_file()</a></code>.Then creates an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> object, filling it with info and adding it to the <code>incarnations</code> list of the parent <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>.</p>
<p>The original flags will be modified by adding the <code>O_CREAT</code> flag, since the incarnation file must always be created.</p>
<p>If the created incarnation is invalid the error code that has invalidated the session can be found in the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> <code>status</code> parameter.</p>
<p>If we have an invalid parent <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> we return <code>-EAGAIN</code>.</p>
<p>The incarnation file name has the following format: <code>[original filename]_incarnation_[pid]_[timestamp]</code> to make the incarnation file unique. If the original pathname is too long we use the following format <code>/var/tmp/[pid]_[timestamp]</code>. The timestamp is obtained by calling <code>ktime_get_real()</code>. </p>
<p>We need to grab the parent <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> lock in read mode from when we copy the original file over the incarnation file; since we do not need to protect the lockless list when adding elements, but the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> incarnations must be created atomically in respect to close operations on the same original file The lock is released when the incarnation has been added to the list.</p>

<p class="reference">References <a class="el" href="session__info_8c.html#a05e60807f715e0eee172cc7f4f58aec7">add_incarnation_info()</a>, <a class="el" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6">copy_file()</a>, <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>, <a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8">open_file()</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">create_session()</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a2c676ca524171b7f600b7f0189266167_cgraph.png" border="0" usemap="#session__manager_8c_a2c676ca524171b7f600b7f0189266167_cgraph" alt=""/></div>
<map name="session__manager_8c_a2c676ca524171b7f600b7f0189266167_cgraph" id="session__manager_8c_a2c676ca524171b7f600b7f0189266167_cgraph">
<area shape="rect" title="Creates an incarnation and add it to an existing session." alt="" coords="5,56,148,83"/>
<area shape="rect" href="session__info_8c.html#a05e60807f715e0eee172cc7f4f58aec7" title="Adds a new kobject attribute representing an incarnation." alt="" coords="196,5,355,32"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="235,56,316,83"/>
<area shape="rect" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space." alt="" coords="234,107,317,133"/>
<area shape="rect" href="session__info_8c.html#af9d987f87f3c55859d5f3712989a8ac7" title="The function used to read the SysFS incarnations attribute files." alt="" coords="403,5,537,32"/>
</map>
</div>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a2c676ca524171b7f600b7f0189266167_icgraph.png" border="0" usemap="#session__manager_8c_a2c676ca524171b7f600b7f0189266167_icgraph" alt=""/></div>
<map name="session__manager_8c_a2c676ca524171b7f600b7f0189266167_icgraph" id="session__manager_8c_a2c676ca524171b7f600b7f0189266167_icgraph">
<area shape="rect" title="Creates an incarnation and add it to an existing session." alt="" coords="632,5,775,32"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="465,5,584,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="ae86586f2293bf35b1b57be58af0b9588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae86586f2293bf35b1b57be58af0b9588">&#9670;&nbsp;</a></span>create_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structincarnation.html">incarnation</a>* create_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new session for the specified file. </p>
<p>To create a new session we check if the original file was already opened with session semantic, by searching for an existing <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> with the same <code>pathname</code> using <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>. If the found <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> is invalid or a matching <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object is not found a new <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object will be created, using <code><a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname.">init_session()</a></code>. Then we create a new <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> of the original file with <code><a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session.">create_incarnation()</a></code>.</p>
<p>When the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> has been created the <code>refcount</code> of the parent session is decremented.</p>
<p><code>-EAGAIN</code> is returned if the created session is invalid. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">create_incarnation()</a>, <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>, <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>, <a class="el" href="session__manager_8c.html#ad40327c746e8ef715109d9b9257eb991">NO_PID</a>, <a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session()</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3">device_ioctl()</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_cgraph.png" border="0" usemap="#session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_cgraph" alt=""/></div>
<map name="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_cgraph" id="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_cgraph">
<area shape="rect" title="Create a new session for the specified file." alt="" coords="5,183,124,209"/>
<area shape="rect" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session." alt="" coords="172,81,315,108"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="383,157,501,184"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="194,208,293,235"/>
<area shape="rect" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="381,309,503,336"/>
<area shape="rect" href="session__info_8c.html#a05e60807f715e0eee172cc7f4f58aec7" title="Adds a new kobject attribute representing an incarnation." alt="" coords="363,56,521,83"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="401,5,483,32"/>
<area shape="rect" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space." alt="" coords="401,107,483,133"/>
<area shape="rect" href="session__info_8c.html#af9d987f87f3c55859d5f3712989a8ac7" title="The function used to read the SysFS incarnations attribute files." alt="" coords="577,56,711,83"/>
<area shape="rect" href="session__info_8c.html#a5c06075650f0014909ac3ed682ff71aa" title="Adds a new kobject representing an original file, under the SessionFS kobject." alt="" coords="375,259,509,285"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="369,208,515,235"/>
<area shape="rect" href="session__info_8c.html#a6e1507e9b7ff0a2d7eae6e9db7a6a41a" title="The function used to read the SysFS active_incarnations_num attribute file." alt="" coords="569,251,719,293"/>
</map>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_icgraph.png" border="0" usemap="#session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_icgraph" alt=""/></div>
<map name="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_icgraph" id="session__manager_8c_ae86586f2293bf35b1b57be58af0b9588_icgraph">
<area shape="rect" title="Create a new session for the specified file." alt="" coords="465,5,584,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="a18273cf2fcf61730e36b611412c0700d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18273cf2fcf61730e36b611412c0700d">&#9670;&nbsp;</a></span>delete_incarnation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int delete_incarnation </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsession.html">session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>filedes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>overwrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes the given <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>The session containing the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> to be removed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filedes</td><td>The file descriptor that identifies the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pid</td><td>The pid of the owner of the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">overwrite</td><td>If set to <code><a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb" title="Used to determine if the content of the incarnation must overwrite the original file on close.">OVERWRITE_ORIG</a></code> it will overwrite the original file with the content of the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> which is going to be removed, otherwise the current <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> is simply removed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 or an error code (<code>-ENOENT</code> if the incarnation can't be found).</dd></dl>
<p>Searches the <code>incarnations</code> list of the given <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> for the current <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code>, copies the contents of the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> over the original file (if <code>overwrite</code> is set to <code><a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb" title="Used to determine if the content of the incarnation must overwrite the original file on close.">OVERWRITE_ORIG</a></code>) and marks it as invalid. The userspace library needs to close and remove the file.</p>
<p>When the incarnation is removed, SysFS is updated with <code><a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject.">remove_incarnation_info()</a></code>. There could be processes still referencing the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> associated SysFS files after their removal, so the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> will remain in the lockless list and will be deallocated when the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> will be deleted. </p>
<p>The <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> to be closed will be marked as invalid, by setting its <code>status</code> member to <code>-ENOENT</code></p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6">copy_file()</a>, <a class="el" href="session__manager_8c.html#a84e60a710f82dcfbc7f311e7787afedb">OVERWRITE_ORIG</a>, <a class="el" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0">remove_incarnation_info()</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">close_session()</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_cgraph.png" border="0" usemap="#session__manager_8c_a18273cf2fcf61730e36b611412c0700d_cgraph" alt=""/></div>
<map name="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_cgraph" id="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_cgraph">
<area shape="rect" title="Removes the given incarnation." alt="" coords="5,31,148,57"/>
<area shape="rect" href="session__manager_8c.html#a8c0e032011c18f8eb45eaa72a9a656d6" title="Copy the contents of a file into another." alt="" coords="247,5,329,32"/>
<area shape="rect" href="session__info_8c.html#a49532cff908aa827fb90e1d4e3dcd2b0" title="Removes the kobject attribute incarnation from a kobject." alt="" coords="196,56,380,83"/>
</map>
</div>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_icgraph.png" border="0" usemap="#session__manager_8c_a18273cf2fcf61730e36b611412c0700d_icgraph" alt=""/></div>
<map name="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_icgraph" id="session__manager_8c_a18273cf2fcf61730e36b611412c0700d_icgraph">
<area shape="rect" title="Removes the given incarnation." alt="" coords="625,5,768,32"/>
<area shape="rect" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd" title="Closes a session." alt="" coords="465,5,577,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="a018bae728d08b5091b906f491019b6c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a018bae728d08b5091b906f491019b6c6">&#9670;&nbsp;</a></span>delete_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delete_session </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsession.html">session</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocates the given session object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">session</td><td>The session object to deallocate.</td></tr>
  </table>
  </dd>
</dl>
<p>This function is used to free the memory used by the session when nobody is accessing it, this is checked using the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> <code>refcount</code> and the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> kernel object refcount, in the <code>info</code> member.</p>
<p>The method will attempt to deallocate the session object, with all its incarnations, if the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> <code>refcount</code> is 0 and the associated kernel object refcount is 1 (only the current process is using it). Otherwise the method will do nothing. </p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2">clean_manager()</a>, <a class="el" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">close_session()</a>, <a class="el" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">create_session()</a>, and <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a018bae728d08b5091b906f491019b6c6_icgraph.png" border="0" usemap="#session__manager_8c_a018bae728d08b5091b906f491019b6c6_icgraph" alt=""/></div>
<map name="session__manager_8c_a018bae728d08b5091b906f491019b6c6_icgraph" id="session__manager_8c_a018bae728d08b5091b906f491019b6c6_icgraph">
<area shape="rect" title="Deallocates the given session object." alt="" coords="843,132,961,159"/>
<area shape="rect" href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="672,56,795,83"/>
<area shape="rect" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd" title="Closes a session." alt="" coords="508,107,620,133"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="505,157,623,184"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="684,208,783,235"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="337,107,437,133"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843" title="Releases the device and frees the used memory." alt="" coords="504,5,624,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,107,269,133"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,107,128,133"/>
<area shape="rect" href="module_8c.html#abd810a6f947c3b87a782a9aad746eef3" title=" " alt="" coords="317,5,456,32"/>
</map>
</div>

</div>
</div>
<a id="a34e2a89cc6c7c38749c5da0ef5c18fd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34e2a89cc6c7c38749c5da0ef5c18fd8">&#9670;&nbsp;</a></span>delete_session_rcu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delete_session_rcu </td>
          <td>(</td>
          <td class="paramtype">struct rcu_head *&#160;</td>
          <td class="paramname"><em>head</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocates a <code><a class="el" href="structsession__rcu.html" title="RCU item that contains a session.">session_rcu</a></code> element. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">head</td><td>The <code>rcu_head</code> struct contained inside the <code><a class="el" href="structsession__rcu.html" title="RCU item that contains a session.">session_rcu</a></code> to deallcoate.</td></tr>
  </table>
  </dd>
</dl>
<p>Used to deallocate the <code><a class="el" href="structsession__rcu.html" title="RCU item that contains a session.">session_rcu</a></code> element after it has been removed from the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list.</p>
<p><b>DO NOT</b> directly call this function, instead you should let this function be called by <code>call_rcu()</code> when nobody is accessing anymore this element. </p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2">clean_manager()</a>, <a class="el" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">close_session()</a>, and <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>.</p>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a34e2a89cc6c7c38749c5da0ef5c18fd8_icgraph.png" border="0" usemap="#session__manager_8c_a34e2a89cc6c7c38749c5da0ef5c18fd8_icgraph" alt=""/></div>
<map name="session__manager_8c_a34e2a89cc6c7c38749c5da0ef5c18fd8_icgraph" id="session__manager_8c_a34e2a89cc6c7c38749c5da0ef5c18fd8_icgraph">
<area shape="rect" title="Deallocates a session_rcu element." alt="" coords="843,107,989,133"/>
<area shape="rect" href="session__manager_8h.html#a96edb8992f8537a88c79b896b45d47c2" title="Releases all the incarnations that are associated with a dead/zombie pid." alt="" coords="672,56,795,83"/>
<area shape="rect" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd" title="Closes a session." alt="" coords="508,107,620,133"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="684,157,783,184"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="337,107,437,133"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#ac7ee6e3825fe5ac77a75a42e4da28843" title="Releases the device and frees the used memory." alt="" coords="504,5,624,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,107,269,133"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,107,128,133"/>
<area shape="rect" href="module_8c.html#abd810a6f947c3b87a782a9aad746eef3" title=" " alt="" coords="317,5,456,32"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="505,157,623,184"/>
</map>
</div>

</div>
</div>
<a id="abd67495092f6edf4b7e5b6ae94be3154"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd67495092f6edf4b7e5b6ae94be3154">&#9670;&nbsp;</a></span>init_manager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_manager </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization of the session manager data structures. </p>
<p>Initializes the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> global variable as an empty list. Avoids the RCU initialization since we can't receive requests yet, so no one will use this list for now. Then initializes the <code><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc" title="Spinlock used to update the list of the active session(s)">sessions_lock</a></code> spinlock. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, and <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>.</p>

<p class="reference">Referenced by <a class="el" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab">init_device()</a>.</p>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_abd67495092f6edf4b7e5b6ae94be3154_icgraph.png" border="0" usemap="#session__manager_8c_abd67495092f6edf4b7e5b6ae94be3154_icgraph" alt=""/></div>
<map name="session__manager_8c_abd67495092f6edf4b7e5b6ae94be3154_icgraph" id="session__manager_8c_abd67495092f6edf4b7e5b6ae94be3154_icgraph">
<area shape="rect" title="Initialization of the session manager data structures." alt="" coords="317,5,425,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="abe3ac55880f2af28017214c50a38d487"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe3ac55880f2af28017214c50a38d487">&#9670;&nbsp;</a></span>init_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsession.html">session</a>* init_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the session information for the given pathname. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pathname</td><td>The path of the original file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>The flags that regulate the access to the original file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>The permissions to apply to newly created files.</td></tr>
  </table>
  </dd>
</dl>
<p>To create a new <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object we open the matching file using <code><a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space.">open_file()</a></code>, then we get the spinlock <code><a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc" title="Spinlock used to update the list of the active session(s)">sessions_lock</a></code> to avoid race coditions and a search is issued, using <code><a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr...">search_session()</a></code>, to see if there is already a matching session with the same <code>pathname</code> to be returned.</p>
<p>If the search gives an invalid object or <code>NULL</code> we proceed in the session creation, creating and adding the <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> object in the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list and calling <code><a class="el" href="session__info_8c.html#a5c06075650f0014909ac3ed682ff71aa" title="Adds a new kobject representing an original file, under the SessionFS kobject.">add_session_info()</a></code>. Finally we release the spinlock.</p>
<p>The original flags will be modified by removing the <code>O_RDONLY</code> and <code>O_WRONLY</code> in favor of <code>O_RDWR</code>, since we will always read and write on this file. In this way we preserve the effects of the <code>O_EXCL</code> flag if specified from userspace. </p>

<p class="reference">References <a class="el" href="session__info_8c.html#a5c06075650f0014909ac3ed682ff71aa">add_session_info()</a>, <a class="el" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6">delete_session()</a>, <a class="el" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8">delete_session_rcu()</a>, <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>, <a class="el" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8">open_file()</a>, <a class="el" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f">search_session()</a>, <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, <a class="el" href="session__manager_8c.html#a8969353f4c2bc47763ade4fc6cf466dc">sessions_lock</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">create_session()</a>.</p>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_abe3ac55880f2af28017214c50a38d487_cgraph.png" border="0" usemap="#session__manager_8c_abe3ac55880f2af28017214c50a38d487_cgraph" alt=""/></div>
<map name="session__manager_8c_abe3ac55880f2af28017214c50a38d487_cgraph" id="session__manager_8c_abe3ac55880f2af28017214c50a38d487_cgraph">
<area shape="rect" title="Initializes the session information for the given pathname." alt="" coords="5,114,104,141"/>
<area shape="rect" href="session__info_8c.html#a5c06075650f0014909ac3ed682ff71aa" title="Adds a new kobject representing an original file, under the SessionFS kobject." alt="" coords="158,13,293,39"/>
<area shape="rect" href="session__manager_8c.html#a018bae728d08b5091b906f491019b6c6" title="Deallocates the given session object." alt="" coords="166,63,285,90"/>
<area shape="rect" href="session__manager_8c.html#a34e2a89cc6c7c38749c5da0ef5c18fd8" title="Deallocates a session_rcu element." alt="" coords="152,114,299,141"/>
<area shape="rect" href="session__manager_8c.html#a2dd653e4fa6e0dd5f0b4ea3d697679d8" title="Opens a file from kernel space." alt="" coords="184,165,267,191"/>
<area shape="rect" href="session__manager_8c.html#abe5de8d0745f9cc09c02191e1818001f" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="165,215,286,242"/>
<area shape="rect" href="session__info_8c.html#a6e1507e9b7ff0a2d7eae6e9db7a6a41a" title="The function used to read the SysFS active_incarnations_num attribute file." alt="" coords="347,5,496,47"/>
</map>
</div>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_abe3ac55880f2af28017214c50a38d487_icgraph.png" border="0" usemap="#session__manager_8c_abe3ac55880f2af28017214c50a38d487_icgraph" alt=""/></div>
<map name="session__manager_8c_abe3ac55880f2af28017214c50a38d487_icgraph" id="session__manager_8c_abe3ac55880f2af28017214c50a38d487_icgraph">
<area shape="rect" title="Initializes the session information for the given pathname." alt="" coords="632,5,731,32"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="465,5,584,32"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,5,417,32"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,5,269,32"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="a2dd653e4fa6e0dd5f0b4ea3d697679d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dd653e4fa6e0dd5f0b4ea3d697679d8">&#9670;&nbsp;</a></span>open_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int open_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd_needed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file **&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Opens a file from kernel space. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pathname</td><td>String that represents the file location and name and <b>must be in kernel memory</b> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Flags that will regulate the permissions on the file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>The permissions to apply to newly created files. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fd_needed</td><td>If set to <code><a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24" title="Used to toggle the necessity of a file descriptor in open_file() and to determine the type of search ...">NO_FD</a></code> the file descriptor for the openend file will not be assigned (used only when we are opening original files). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">file</td><td>pointer to the file struct of the opened file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The file descriptor on success, the error code or <code><a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24" title="Used to toggle the necessity of a file descriptor in open_file() and to determine the type of search ...">NO_FD</a></code> if no file descriptor was requested.</dd></dl>
<p>This function will open the file at the specified pathname and then associate a file descriptor to the opened file. If the <code>O_CREAT</code> flags is specified the permissions for the newly created file will be defined by the <code>mode</code> parameter or, if this is -1 by <code><a class="el" href="session__manager_8c.html#ae93be9f917eb7dbc1863a710f7a7b0bc" title="Permissions to be given to the newly created files.">DEFAULT_PERM</a></code>. If <code>fd_needed</code> is set to <code><a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24" title="Used to toggle the necessity of a file descriptor in open_file() and to determine the type of search ...">NO_FD</a></code> then the opened file won't have a file descriptor associated. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#ae93be9f917eb7dbc1863a710f7a7b0bc">DEFAULT_PERM</a>, and <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167">create_incarnation()</a>, and <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>.</p>
<div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_a2dd653e4fa6e0dd5f0b4ea3d697679d8_icgraph.png" border="0" usemap="#session__manager_8c_a2dd653e4fa6e0dd5f0b4ea3d697679d8_icgraph" alt=""/></div>
<map name="session__manager_8c_a2dd653e4fa6e0dd5f0b4ea3d697679d8_icgraph" id="session__manager_8c_a2dd653e4fa6e0dd5f0b4ea3d697679d8_icgraph">
<area shape="rect" title="Opens a file from kernel space." alt="" coords="823,31,905,57"/>
<area shape="rect" href="session__manager_8c.html#a2c676ca524171b7f600b7f0189266167" title="Creates an incarnation and add it to an existing session." alt="" coords="632,5,775,32"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="654,56,753,83"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="465,31,584,57"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,31,417,57"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,31,269,57"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,31,128,57"/>
</map>
</div>

</div>
</div>
<a id="abe5de8d0745f9cc09c02191e1818001f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe5de8d0745f9cc09c02191e1818001f">&#9670;&nbsp;</a></span>search_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsession.html">session</a>* search_session </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>filedes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Searches for a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> with a given pathname, or with an <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> with matching pid and file descriptor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pathname</td><td>The pathname that identifies the session. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filedes</td><td>The file descriptor of an incarnation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pid</td><td>The pid of the process that owns the incarnation. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the found <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> or <code>NULL</code>.</dd></dl>
<p>Searches, by navigating the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> rcu list, a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> which matches the given <code>pathname</code>. If <code>pathname</code> is NULL, <code>filedes</code> is differrent from <code><a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24" title="Used to toggle the necessity of a file descriptor in open_file() and to determine the type of search ...">NO_FD</a></code> and <code>pid</code> is differrent from <code><a class="el" href="session__manager_8c.html#ad40327c746e8ef715109d9b9257eb991" title="Used to determine the type of search in search_session().">NO_PID</a></code> then it searches for the session that contains an incarnation with the corresponding pid an file descriptor. While walking the <code><a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e" title="List of the active session(s).">sessions</a></code> list the reference counter counter of any session currently inspected, <code>refcount</code>, will be incremented. If the session is not the one we are looking for then <code>refcount</code> will be decremented before inspecting the next <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code>. If a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> is invalid it will be skipped.</p>
<p>Additionally while walking the <code><a class="el" href="structincarnation.html" title="Informations on an incarnation of a file.">incarnation</a></code> list of a <code><a class="el" href="structsession.html" title="General information on a session.">session</a></code> we grab the <code>sess_lock</code> in read mode, to avoid that a concurrent process modifies the list while we are walking it. When we finish walking the list we will release the lock. </p>

<p class="reference">References <a class="el" href="session__manager_8c.html#aa071d9c19b2a41c3c4efe8d803d74a24">NO_FD</a>, <a class="el" href="session__manager_8c.html#ad40327c746e8ef715109d9b9257eb991">NO_PID</a>, <a class="el" href="session__manager_8c.html#a16d321e233eeb27c5fa65d1b7519477e">sessions</a>, and <a class="el" href="session__manager_8c.html#a555d7056ccbb35a92c11165f1e82c406">VALID_NODE</a>.</p>

<p class="reference">Referenced by <a class="el" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd">close_session()</a>, <a class="el" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588">create_session()</a>, and <a class="el" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487">init_session()</a>.</p>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><img src="session__manager_8c_abe5de8d0745f9cc09c02191e1818001f_icgraph.png" border="0" usemap="#session__manager_8c_abe5de8d0745f9cc09c02191e1818001f_icgraph" alt=""/></div>
<map name="session__manager_8c_abe5de8d0745f9cc09c02191e1818001f_icgraph" id="session__manager_8c_abe5de8d0745f9cc09c02191e1818001f_icgraph">
<area shape="rect" title="Searches for a session with a given pathname, or with an incarnation with matching pid and file descr..." alt="" coords="779,56,900,83"/>
<area shape="rect" href="session__manager_8h.html#a1594b401bd3a9bb39decd88759bfbebd" title="Closes a session." alt="" coords="469,5,581,32"/>
<area shape="rect" href="session__manager_8h.html#ae86586f2293bf35b1b57be58af0b9588" title="Create a new session for the specified file." alt="" coords="465,56,584,83"/>
<area shape="rect" href="session__manager_8c.html#abe3ac55880f2af28017214c50a38d487" title="Initializes the session information for the given pathname." alt="" coords="632,107,731,133"/>
<area shape="rect" href="device__sessionfs_8c.html#a72e3cac371d57c08b7a62d2cb9e13fb3" title="Handles the ioctls calls issued to the SessionFS_dev device." alt="" coords="317,31,417,57"/>
<area shape="rect" href="device__sessionfs__mod_8h.html#a88bd4adb20dc9040ae78f5b4036b61ab" title="Device initialization and registration." alt="" coords="176,31,269,57"/>
<area shape="rect" href="module_8c.html#af4b79167ea5472e999750f3f28dd0f74" title="Loads the device when the kernel module is loaded in the kernel." alt="" coords="5,31,128,57"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_b6e26c987379c818ae1a7be6334a2c88.html">kmodule</a></li><li class="navelem"><a class="el" href="session__manager_8c.html">session_manager.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
